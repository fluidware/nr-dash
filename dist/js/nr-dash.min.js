/*! nr-dash - 1.0.4 */!function(a,b,c,d,e){"use strict";function f(a,b,c){c=c||{};var d=t.defer(),f=c.width||500,g=c.height||420;return J(function(){var h,i,j,k,l,m;try{h=w.create("div",{"class":"chart"},a),i=e.newSvg("#"+h.id,f,g),j=new e.chart(i,b||[]),H.colors&&H.colors.length>0&&(j.defaultColors=H.colors.map(function(a){return new e.color(a)})),j.setBounds(60,75,f-95,275),k=j.addCategoryAxis("x","time"),k.addOrderRule("time"),k.title=null,l=j.addMeasureAxis("y","value"),c.title&&(l.title=c.title),c.tickFormat&&(l.tickFormat=c.tickFormat),m=j.addSeries("name",e.plot.line),m.interpolation="cardinal",c.id&&(j.id=c.id),j.addLegend(10,10,f-10,60,"left"),j.draw(),d.resolve(j)}catch(n){d.reject(n)}}),d}function g(b){var c=D(b);"LI"===c.nodeName&&(A(b),y(b),a.location.hash.replace("#","")!==c.childNodes[0].href.replace(M,"")&&(w.dispatch(c.childNodes[0],"click"),x("Dispatched click for navigation target/child")))}function h(a){B(function(){var a=u("ul.pills .active")[0],b=a.nextElementSibling||a.parentNode.childNodes[0];w.hasClass(b,"active")||w.dispatch(b.childNodes[0],"click")},1e3*a,"navCycle",!1)}function i(a){x(a.stack||a.message||a,"error")}function j(){b.addEventListener("hashchange",l,!1),u("nav")[0].addEventListener("click",g,!1),L.addEventListener("render",o,!1),x("Set event listeners"),""!==F&&v.contains(p,F)?(x("Loading hash"),w.klass(u("#"+F)[0],"hidden",!1),w.klass(u("a[href='#"+F+"']")[0].parentNode,"active"),w.dispatch(L,"render")):(x("Loading default"),a.location.hash=q)}function k(){var a=t.defer(),b=v.keySort(H.pills,"name asc"),c=[],d=[],e=H.expire&&!isNaN(H.expire);return v.each(b,function(a){c.push('<li><a href="#'+a.slug+'">'+a.name+"</a></li>"),d.push('<div id="'+a.slug+'" class="hidden"></div>')}),J(function(){var f=[];w.html(K,c.join("")),w.html(L,d.join("")),x("Rendered Elements"),p=u("ul.pills li a").map(function(a){return a.href.replace(M,"")}),q=H["default"]||p[0],v.each(b,function(a){var b;a.uri&&(b=r(null,{id:a.slug,headers:G,key:"id",source:a.source}),f.push(b.setUri(a.uri)),e&&b.setExpires(1e3*H.expire),I[a.slug]=b)}),x("Created DataStores"),E(f).then(function(){x("Retrieved API data"),a.resolve(!0)},function(b){i(b),a.reject(b)})}),a}function l(b){var c=F?F:null,d=a.location.hash?a.location.hash.replace("#",""):null,e=c?u("#"+c)[0]:null,f=d?u("#"+d)[0]:null,g=c?u("a[href='#"+c+"']")[0]:null,h=d?u("a[href='#"+d+"']")[0]:null;A(b),y(b),g&&e&&(w.klass(g.parentNode,"active",!1),w.klass(e,"hidden")),h&&f?(F=d,w.klass(h.parentNode,"active"),w.klass(f,"hidden",!1)):(F=q,a.location.hash=q),w.dispatch(L,"render")}function m(){var a=t.defer();return C("config").then(function(b){b.api?(x("Retrieved configuration"),t.merge(H,b),G["X-Api-Key"]=H.api,k().then(function(){j(),H.cycle&&!isNaN(H.pause)&&H.pause>0&&h(H.pause),a.resolve(!0)},function(b){a.reject(b)})):i(new Error("API key not found"))},function(b){a.reject(b)}),a}function n(){var a,b=F,c=t.defer(),e=[],f=/\:host/,g=H.pills.filter(function(a){return a.slug===b})[0].metrics;return void 0!==g&&(0===g.instances.length?c.resolve({}):(a=new Function("arg","return /^"+g.instances.map(function(a){return z.escape(a)}).join("|")+"$/i.test( arg );"),I[b].select({name:a}).then(function(a){v.each(a,function(a){var c=g.uri.replace(":id",a.key)+"?names[]="+g.names.join("&names[]="),d=z.singular(b)+"_hosts";f.test(c)?void 0!==a.data.links&&void 0!==a.data.links[d]&&a.data.links[d].length>0&&(c=c.replace(f,a.data.links[d][0]||0),e.push(C(c,"GET",null,null,null,G))):e.push(C(c,"GET",null,null,null,G))}),e.length>0?E(e).then(function(e){var f={},g=(new Date).getTimezoneOffset();e instanceof Array||(e=[e]),b===F?(v.each(v.mingle(a,e.map(function(a){return null===a?a:a.metric_data.metrics})),function(a){v.each(a[1],function(b){var c,e=b.name.split("/");c="Function"===e[1]?e[2]:e[1],void 0===f[c]&&(f[c]=[]),v.each(b.timeslices,function(b){f[c].push({name:a[0].data.name,time:d.utc(b.from).zone(g).format(H.xformat),value:b.values.per_second||b.values.average_value||b.values.value||b.values.score})})})}),c.resolve(f)):c.reject(new Error("Hash has changed, data is stale"))},function(a){c.reject(a)}):c.resolve({})},function(a){c.reject(a)}))),c}function o(){var a,b,c=F,d=I[c],e=u("#"+c)[0],g=new RegExp(H.si),h=H.pills.filter(function(a){return a.slug===c})[0],j=h.fields,k=h.order;0===e.childNodes.length?(x("Rendering '"+c+"'"),void 0!==h.metrics?n().then(function(a){var h=[];c==F&&(v.each(v.keys(a),function(c){var d={title:c,id:c};void 0===b&&(b=w.create("section",{"class":"charts"},e)),g.test(c)&&(d.tickFormat="s"),h.push(f(b,a[c],d))}),J(function(){s(e,d,j,j,{order:k,pageSize:H.pageSize},!0),void 0!==b&&w.klass(w.find(e,"> .grid")[0],"hasCharts"),x("Rendered view of '"+c+"'")}),E(h).then(function(a){c==F&&(null!==a&&a.length>0&&x("Rendered charts for '"+c+"'"),null!==a&&a.length>0&&d.on("afterSync",function(){d.id===c&&n().then(function(b){v.each(a,function(a){try{a.data=b[a.id],J(function(){a.draw(1e3*H.transition)})}catch(c){}})})}),x("Bound charts and DataStore for '"+c+"'"))},function(){x("Failed to render charts for '"+c+"'")}))},function(a){i(a),J(function(){s(e,d,j,j,{order:k,pageSize:H.pageSize},!0),x("Rendered view of '"+c+"'")})}):(a=function(a){var b=w.find(a,"span."+z.singular(c)+"_name")[0],d=b?w.text(b):"";void 0!==b&&w.html(b,'<a title="'+d+'" class="tooltip">'+d+"</a>")},J(function(){s(e,d,j,j,{callback:a,order:k,pageSize:H.pageSize},!0)}))):x("Viewing '"+c+"'")}var p,q,r=c.store,s=c.grid,t=c.util,u=t.$,v=t.array,w=t.element,x=t.log,y=t.stop,z=t.string,A=t.prevent,B=t.repeat,C=t.request,D=t.target,E=t.when,F=a.location.hash.replace("#",""),G={},H={},I={},J=t.render,K=u("ul.pills")[0],L=u("section.copy")[0],M=/.*\#/;b.nrDash={stores:I,version:"1.0.4"},m().then(function(){x("nr-dash is running")},function(){i("nr-dash failed to start")})}(document,window,keigai,moment,dimple);